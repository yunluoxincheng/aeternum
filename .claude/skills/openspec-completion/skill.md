# OpenSpec å®Œæˆæƒ…å†µå®¡æŸ¥æŠ€èƒ½

**ç‰ˆæœ¬**: 1.0.0
**ä½œè€…**: Aeternum Team
**ç”¨é€”**: å®¡æŸ¥ OpenSpec æ’æ¡ˆå®ç°åçš„ä»£ç è´¨é‡ã€æ–‡æ¡£ç¬¦åˆæ€§å’Œå®‰å…¨æ€§

---

## æŠ€èƒ½ç›®æ ‡

æœ¬æŠ€èƒ½è§£å†³"ææ¡ˆå®ç°è´¨é‡å‚å·®ä¸é½"çš„é—®é¢˜ï¼Œé€šè¿‡**5å±‚å®¡æŸ¥æ¡†æ¶**ç¡®ä¿ï¼š

1. **Layer 1 - Checkpoint åˆè§„æ€§**: éªŒè¯å¼€å‘å‰æ–‡æ¡£è¦æ±‚å·²æ»¡è¶³
2. **Layer 2 - æ–‡æ¡£ç¬¦åˆæ€§**: éªŒè¯å®ç°ä¸ææ¡ˆæ–‡æ¡£ä¸€è‡´
3. **Layer 3 - ä»£ç è´¨é‡**: ç¼–è¯‘ã€Clippyã€æ ¼å¼ã€æ–‡æ¡£æ³¨é‡Šæ£€æŸ¥
4. **Layer 4 - æ·±åº¦æµ‹è¯•åˆ†æ**: æµ‹è¯•æ‰§è¡Œ + è¦†ç›–ç‡ + ç¼ºå¤±åœºæ™¯è¯†åˆ«
5. **Layer 5 - å®‰å…¨æ€§ä¸ä¸å˜é‡**: å››å¤§æ•°å­¦ä¸å˜é‡ + Zeroize + å¯†é’¥æ³„æ¼æ£€æŸ¥

---

## ä¸ openspec-review çš„åŒºåˆ«

| ç»´åº¦ | openspec-review | openspec-completion |
|------|----------------|---------------------|
| **å®¡æŸ¥æ—¶æœº** | ææ¡ˆåˆ›å»ºåï¼Œå®ç°å‰ | ææ¡ˆå®ç°å®Œæˆå |
| **å®¡æŸ¥å¯¹è±¡** | ææ¡ˆ**æ–‡æ¡£**è´¨é‡ | å®ç°**ä»£ç **è´¨é‡ |
| **å®¡æŸ¥é‡ç‚¹** | OpenSpec è§„èŒƒåˆè§„æ€§ | åŠŸèƒ½å®Œæˆåº¦ + ä»£ç è´¨é‡ + å®‰å…¨æ€§ |
| **å…¸å‹åœºæ™¯** | æäº¤ææ¡ˆå‰è‡ªæ£€ | åˆå¹¶ä»£ç å‰éªŒæ”¶ |

---

## è§¦å‘æ–¹å¼

### æ‰‹åŠ¨è°ƒç”¨

```bash
# å®¡æŸ¥æŒ‡å®šææ¡ˆ
/openspec-completion add-models

# å®¡æŸ¥å½“å‰æ´»è·ƒçš„æ‰€æœ‰ææ¡ˆ
/openspec-completion --all

# å®¡æŸ¥å¹¶è‡ªåŠ¨ä¿å­˜æŠ¥å‘Š
/openspec-completion add-models --save

# ä»…æ˜¾ç¤ºæ‘˜è¦ï¼ˆæ— è¯¦ç»†é—®é¢˜åˆ†æï¼‰
/openspec-completion add-models --summary

# ä¸¥æ ¼æ¨¡å¼ï¼ˆåŒ…æ‹¬ INFO çº§åˆ«çš„é—®é¢˜ï¼‰
/openspec-completion add-models --strict
```

### è‡ªç„¶è¯­è¨€è§¦å‘

```
- "å®¡æŸ¥ add-models ææ¡ˆçš„å®ç°æƒ…å†µ"
- "æ£€æŸ¥ add-models æ˜¯å¦å®Œæˆ"
- "å®¡æŸ¥ openspec ææ¡ˆçš„ä»£ç è´¨é‡"
- "éªŒè¯ add-models çš„å®ç°æ˜¯å¦ç¬¦åˆæ–‡æ¡£"
- "è¿è¡Œ openspec å®Œæˆæƒ…å†µå®¡æŸ¥"
```

---

## å®¡æŸ¥å·¥ä½œæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 1: è§£æè¾“å…¥å‚æ•°                                    â”‚
â”‚     - æå– change-id æˆ– --all flag                      â”‚
â”‚     - ç¡®å®šè¾“å‡ºé€‰é¡¹ (--save, --summary, --strict)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 2: å®šä½å¹¶è¯»å–ææ¡ˆ                                  â”‚
â”‚     - openspec/changes/<change-id>/                     â”‚
â”‚     - è¯»å– proposal.md, tasks.md, specs/*/spec.md     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 3: æ‰§è¡Œåˆ†å±‚å®¡æŸ¥                                    â”‚
â”‚     for layer in [L1, L2, L3, L4, L5]:                 â”‚
â”‚         findings[layer] = run_checks(layer)            â”‚
â”‚         æ”¶é›†ï¼šfile, line, severity, description, fix    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 4: ç”ŸæˆæŠ¥å‘Š                                        â”‚
â”‚     - æŒ‰ä¸¥é‡ç¨‹åº¦æ’åºæ‰€æœ‰é—®é¢˜                             â”‚
â”‚     - ç”Ÿæˆæ§åˆ¶å°è¾“å‡ºï¼ˆå¸¦é¢œè‰²/æ ¼å¼ï¼‰                      â”‚
â”‚     - å¯é€‰ï¼šå†™å…¥ reports/openspec-completion-<id>.md   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 5: ç”¨æˆ·ç¡®è®¤ä¸å»ºè®®                                  â”‚
â”‚     - è¯¢é—®æ˜¯å¦ä¿å­˜æŠ¥å‘Š                                   â”‚
â”‚     - æ˜¾ç¤ºä¿®å¤ä¼˜å…ˆçº§åˆ—è¡¨                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ä¸¥é‡ç¨‹åº¦åˆ†çº§

| çº§åˆ« | ç¬¦å· | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|------|
| **CRITICAL** | ğŸ”´ | é˜»å¡æ€§é—®é¢˜ï¼Œå¿…é¡»ä¿®å¤ | è¿åæ•°å­¦ä¸å˜é‡ã€æµ‹è¯•å¤±è´¥ |
| **ERROR** | âŒ | ä¸¥é‡é—®é¢˜ï¼Œé˜»å¡åˆå¹¶ | ç¼ºå°‘ Zeroizeã€æ–‡æ¡£ä¸ç¬¦åˆ |
| **WARNING** | âš ï¸ | è­¦å‘Šé—®é¢˜ï¼Œå¼ºçƒˆå»ºè®®ä¿®å¤ | æµ‹è¯•è¦†ç›–ä¸è¶³ã€clippy è­¦å‘Š |
| **INFO** | â„¹ï¸ | ä¿¡æ¯æç¤ºï¼Œå¯é€‰ä¿®å¤ | æ³¨é‡Šä¸å®Œæ•´ã€å¯ä¼˜åŒ–é¡¹ |
| **PASS** | âœ… | é€šè¿‡æ£€æŸ¥ | - |

---

## æ£€æŸ¥é¡¹ç›®æ¸…å•

### Layer 1 - Checkpoint åˆè§„æ€§å®¡æŸ¥

| æ£€æŸ¥é¡¹ | æè¿° | é”™è¯¯ä»£ç  |
|--------|------|----------|
| ä»»åŠ¡ç±»å‹è¯†åˆ« | æ ¹æ® change-id å’Œä»£ç è·¯å¾„è‡ªåŠ¨è¯†åˆ«ä»»åŠ¡ç±»å‹ | L1-001 |
| å¿…è¯»æ–‡æ¡£å­˜åœ¨ | æ£€æŸ¥ checkpoint è¦æ±‚çš„æ–‡æ¡£æ˜¯å¦å­˜åœ¨äº docs/ | L1-002 |
| çº¦æŸç¬¦åˆæ€§ | ä»£ç æ˜¯å¦è¿å checkpoint å®šä¹‰çš„ä¸å¯è¿åçº¦æŸ | L1-003 |
| è¾“å‡ºç›®å½•æ­£ç¡® | ä»£ç æ˜¯å¦æ”¾åœ¨æ­£ç¡®çš„ç›®å½•ï¼ˆcrypto/protocol/android/bridgeï¼‰ | L1-004 |

### Layer 2 - æ–‡æ¡£ç¬¦åˆæ€§å®¡æŸ¥

| æ£€æŸ¥é¡¹ | æè¿° | é”™è¯¯ä»£ç  |
|--------|------|----------|
| proposal.md æ‰¿è¯ºå…‘ç° | proposal.md ä¸­åˆ—å‡ºçš„æ‰€æœ‰å˜æ›´æ˜¯å¦å·²å®ç° | L2-001 |
| spec.md éœ€æ±‚è¦†ç›– | specs/*/spec.md çš„æ¯ä¸ª requirement æ˜¯å¦æœ‰å¯¹åº”å®ç°å’Œæµ‹è¯• | L2-002 |
| scenario æµ‹è¯•è¦†ç›– | æ¯ä¸ª scenario æ˜¯å¦æœ‰å¯¹åº”æµ‹è¯•ç”¨ä¾‹ | L2-003 |
| tasks.md å®Œæˆåº¦ | tasks.md ä¸­æ‰€æœ‰ä»»åŠ¡æ˜¯å¦æ ‡è®°ä¸ºå·²å®Œæˆ | L2-004 |
| éç›®æ ‡æ£€æŸ¥ | ä»£ç æ˜¯å¦è¶…å‡ºææ¡ˆå£°æ˜çš„èŒƒå›´ï¼ˆéç›®æ ‡éƒ¨åˆ†ï¼‰ | L2-005 |

### Layer 3 - ä»£ç è´¨é‡å®¡æŸ¥

| æ£€æŸ¥é¡¹ | æè¿° | é”™è¯¯ä»£ç  |
|--------|------|----------|
| cargo check é€šè¿‡ | ä»£ç ç¼–è¯‘æ— é”™è¯¯å’Œè­¦å‘Š | L3-001 |
| clippy æ¸…æ´ | æ—  clippy lint è­¦å‘Šï¼ˆæˆ–è§£é‡Šåˆç†çš„è­¦å‘Šï¼‰ | L3-002 |
| æ ¼å¼ä¸€è‡´æ€§ | ä»£ç æ ¼å¼ç¬¦åˆé¡¹ç›®æ ‡å‡† | L3-003 |
| pub API æ–‡æ¡£ | æ‰€æœ‰å…¬å…± API æœ‰æ–‡æ¡£æ³¨é‡Šï¼ˆ/// æˆ– //!ï¼‰ | L3-004 |
| unsafe å—å®¡æŸ¥ | unsafe ä»£ç æœ‰å®‰å…¨ç†ç”±æ³¨é‡Š | L3-005 |

### Layer 4 - æ·±åº¦æµ‹è¯•åˆ†æ

| æ£€æŸ¥é¡¹ | æè¿° | é”™è¯¯ä»£ç  |
|--------|------|----------|
| å•å…ƒæµ‹è¯•é€šè¿‡ | æ‰€æœ‰å•å…ƒæµ‹è¯•é€šè¿‡ | L4-001 |
| é›†æˆæµ‹è¯•é€šè¿‡ | æ‰€æœ‰é›†æˆæµ‹è¯•é€šè¿‡ | L4-002 |
| æµ‹è¯•è¦†ç›–ç‡ | å…³é”®è·¯å¾„æµ‹è¯•è¦†ç›–ç‡ â‰¥ 80% | L4-003 |
| é”™è¯¯è·¯å¾„æµ‹è¯• | é”™è¯¯åˆ†æ”¯ï¼ˆResult::Err, Option::Noneï¼‰æœ‰æµ‹è¯• | L4-004 |
| è¾¹ç•Œæ¡ä»¶æµ‹è¯• | è¾¹ç•Œå€¼ï¼ˆç©ºè¾“å…¥ã€æœ€å¤§é•¿åº¦ç­‰ï¼‰æœ‰æµ‹è¯• | L4-005 |
| å±æ€§æµ‹è¯• | å¯†ç å­¦ç›¸å…³ä»£ç æœ‰ proptest æˆ– fuzz æµ‹è¯• | L4-006 |

### Layer 5 - å®‰å…¨æ€§ä¸ä¸å˜é‡å®¡æŸ¥

| æ£€æŸ¥é¡¹ | æè¿° | é”™è¯¯ä»£ç  |
|--------|------|----------|
| Zeroize å®ç° | æ‰€æœ‰ç§˜å¯†ç±»å‹å®ç° Zeroize + ZeroizeOnDrop | L5-001 |
| çºªå…ƒå•è°ƒæ€§ (INV_1) | epoch æ“ä½œä¸¥æ ¼å•è°ƒé€’å¢ | L5-002 |
| Header å®Œå¤‡æ€§ (INV_2) | è®¾å¤‡ä¸ epoch å…³è”æ­£ç¡® | L5-003 |
| å› æœç†µéšœ (INV_3) | RECOVERY è§’è‰²æ— ç®¡ç†æƒé™ | L5-004 |
| å¦å†³æƒä¼˜å…ˆ (INV_4) | 48h çª—å£å¦å†³æœºåˆ¶æ­£ç¡®å®ç° | L5-005 |
| å¯†é’¥æ³„æ¼æ£€æŸ¥ | Debug impl ä¸æš´éœ²å®é™…å¯†é’¥ææ–™ | L5-006 |
| Kotlin æ˜æ–‡ç¦æ­¢ | Kotlin å±‚ä¸æŒæœ‰æ˜æ–‡å¯†é’¥ ByteArray | L5-007 |

---

## æŠ¥å‘Šæ ¼å¼

### æ§åˆ¶å°è¾“å‡ºæ¨¡æ¿

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘           ğŸ” OpenSpec å®Œæˆæƒ…å†µå®¡æŸ¥æŠ¥å‘Š                          â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                               â•‘
â•‘  å˜æ›´ ID: add-models                                          â•‘
â•‘  å®¡æŸ¥æ—¶é—´: 2026-02-13 14:32:15 UTC                             â•‘
â•‘  ææ¡ˆçŠ¶æ€: âœ… å·²æ‰¹å‡† (Approved)                                 â•‘
â•‘  ä»£ç è¿›åº¦: 53% (30/57 tasks completed)                         â•‘
â•‘                                                               â•‘
â•‘  å®¡æŸ¥ç»“æœ: âš ï¸  éœ€ä¿®æ”¹ (1 CRITICAL, 2 ERROR, 3 WARNING)         â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ”´ CRITICAL [L5-002] çºªå…ƒå•è°ƒæ€§è¿åé£é™©
   æ–‡ä»¶: core/src/models/epoch.rs:45
   ä¸¥é‡ç¨‹åº¦: CRITICAL - é˜»å¡æ€§é—®é¢˜ï¼Œå¿…é¡»ä¿®å¤

   é—®é¢˜æè¿°:
   CryptoEpoch::next() æ–¹æ³•ç¼ºå°‘è¾“å…¥ epoch ç‰ˆæœ¬éªŒè¯ï¼Œå¯èƒ½å¯¼è‡´
   éå•è°ƒé€’å¢çš„çºªå…ƒè½¬æ¢ï¼Œè¿å INVARIANT_1ã€‚

   å½“å‰ä»£ç :
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ 41 â”‚     pub fn next(&self) -> Self {                   â”‚
   â”‚ 42 â”‚         Self {                                      â”‚
   â”‚ 43 â”‚             version: self.version + 1,              â”‚
   â”‚ 44 â”‚             timestamp: SystemTime::now(),            â”‚
   â”‚ 45 â”‚             algorithm: self.algorithm.clone(),      â”‚
   â”‚ 46 â”‚         }                                           â”‚
   â”‚ 47 â”‚     }                                               â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

   ä¿®å¤å»ºè®®:
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  pub fn next(&self) -> Result<Self, CryptoError> {      â”‚
   â”‚      let new_version = self.version.checked_add(1)      â”‚
   â”‚          .ok_or(CryptoError::InvariantViolation(        â”‚
   â”‚              "Epoch version overflow".into()))?;        â”‚
   â”‚                                                       â”‚
   â”‚      // éªŒè¯çºªå…ƒå•è°ƒæ€§ï¼ˆINVARIANT_1ï¼‰                    â”‚
   â”‚      if new_version <= self.version {                   â”‚
   â”‚          return Err(CryptoError::InvariantViolation(     â”‚
   â”‚              "Epoch must be monotonically increasing"   â”‚
   â”‚              .into()));                                 â”‚
   â”‚      }                                                  â”‚
   â”‚                                                       â”‚
   â”‚      Ok(Self {                                         â”‚
   â”‚          version: new_version,                         â”‚
   â”‚          timestamp: SystemTime::now(),                 â”‚
   â”‚          algorithm: self.algorithm.clone(),             â”‚
   â”‚      })                                                â”‚
   â”‚  }                                                    â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

   ç›¸å…³æ–‡æ¡£: docs/math/Formal-Invariants.md#INVARIANT_1

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
[... å…¶ä»–é—®é¢˜ ...]

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                     ğŸ“Š å®¡æŸ¥æ‘˜è¦                                â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                               â•‘
â•‘  âœ… Checkpoint åˆè§„æ€§: é€šè¿‡ (4/4 checks)                      â•‘
â•‘  âŒ æ–‡æ¡£ç¬¦åˆæ€§: å¤±è´¥ (1/5 checks) - tasks.md æœªåŒæ­¥           â•‘
â•‘  âš ï¸  ä»£ç è´¨é‡: 3 warnings                                    â•‘
â•‘  âš ï¸  æµ‹è¯•åˆ†æ: è¦†ç›–ç‡ 65% (ç›®æ ‡ â‰¥80%)                        â•‘
â•‘  ğŸ”´ å®‰å…¨æ€§: CRITICAL - INVARIANT_1 è¿åé£é™©                   â•‘
â•‘                                                               â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## å®ç°æ­¥éª¤è¯¦è§£

### Step 1: éªŒè¯è¾“å…¥

```
è¾“å…¥: change-id (å¯é€‰) æˆ– --all flag

éªŒè¯é€»è¾‘:
1. å¦‚æœæŒ‡å®š change-id:
   - æ£€æŸ¥ openspec/changes/<change-id>/ æ˜¯å¦å­˜åœ¨
   - å¦‚æœä¸å­˜åœ¨ï¼ŒæŠ¥é”™å¹¶é€€å‡º

2. å¦‚æœä½¿ç”¨ --all:
   - æ‰«æ openspec/changes/ ä¸‹æ‰€æœ‰å­ç›®å½•
   - è¿‡æ»¤å·²å½’æ¡£çš„ææ¡ˆ

3. å¦‚æœä¸¤è€…éƒ½æœªæŒ‡å®š:
   - æ£€æµ‹æœ€è¿‘ä¿®æ”¹çš„ææ¡ˆ
   - è¯¢é—®ç”¨æˆ·ç¡®è®¤å®¡æŸ¥ç›®æ ‡
```

### Step 2: åŠ è½½ææ¡ˆæ•°æ®

```
å¯¹äºæ¯ä¸ªç›®æ ‡ change-id:

è¯»å–æ–‡ä»¶:
- proposal.md        # ææ¡ˆæ¦‚è¿°
- tasks.md          # ä»»åŠ¡æ¸…å•
- specs/**/spec.md  # è§„èŒƒæ–‡æ¡£
- design.md         # è®¾è®¡æ–‡æ¡£ï¼ˆå¯é€‰ï¼‰

è§£æå†…å®¹:
- æå– "å½±å“èŒƒå›´" éƒ¨åˆ†çš„ä»£ç è·¯å¾„
- æå– tasks.md ä¸­çš„ä»»åŠ¡å®ŒæˆçŠ¶æ€
- æå– specs ä¸­çš„æ‰€æœ‰ requirement å’Œ scenario
- æå– "éç›®æ ‡" éƒ¨åˆ†çš„èŒƒå›´å£°æ˜
```

### Step 3: æ‰§è¡Œåˆ†å±‚æ£€æŸ¥

#### Layer 1 - Checkpoint åˆè§„æ€§æ£€æŸ¥

```
æ ¹æ® proposal.md ä¸­æè¿°çš„å˜æ›´å†…å®¹ï¼Œè‡ªåŠ¨è¯†åˆ«ä»»åŠ¡ç±»å‹:

- æ¶‰åŠ core/src/crypto/      â†’ crypto ä»»åŠ¡
- æ¶‰åŠ core/src/protocol/    â†’ protocol ä»»åŠ¡
- æ¶‰åŠ android/             â†’ android ä»»åŠ¡
- æ¶‰åŠ core/uniffi/*.udl    â†’ bridge ä»»åŠ¡

å¯¹æ¯ç§ä»»åŠ¡ç±»å‹ï¼ŒéªŒè¯:
1. aeternum-checkpoint å®šä¹‰çš„å¿…è¯»æ–‡æ¡£æ˜¯å¦å­˜åœ¨
2. ä»£ç æ˜¯å¦è¿åä¸å¯è¿åçº¦æŸ
3. è¾“å‡ºç›®å½•æ˜¯å¦æ­£ç¡®
```

#### Layer 2 - æ–‡æ¡£ç¬¦åˆæ€§æ£€æŸ¥

```
å¯¹æ¯” proposal.md æ‰¿è¯ºä¸å®é™…ä»£ç :

1. è§£æ proposal.md "æè®®çš„å˜æ›´" éƒ¨åˆ†
   - æå–æ‰¿è¯ºæ–°å¢/ä¿®æ”¹çš„æ–‡ä»¶åˆ—è¡¨

2. éªŒè¯æ–‡ä»¶å­˜åœ¨æ€§
   - éå†æ‰¿è¯ºçš„æ–‡ä»¶è·¯å¾„
   - è®°å½•ç¼ºå¤±çš„æ–‡ä»¶

3. éªŒè¯ spec.md éœ€æ±‚è¦†ç›–
   - å¯¹æ¯ä¸ª requirement: æŸ¥æ‰¾å¯¹åº”å®ç°
   - å¯¹æ¯ä¸ª scenario: æŸ¥æ‰¾å¯¹åº”æµ‹è¯•

4. éªŒè¯ tasks.md å®Œæˆåº¦
   - ç»Ÿè®¡å·²å®Œæˆ vs æ€»ä»»åŠ¡æ•°
   - å¦‚æœ <100%ï¼Œæ ‡è®°ä¸ºé—®é¢˜

5. éªŒè¯éç›®æ ‡è¾¹ç•Œ
   - æ£€æŸ¥æ˜¯å¦å®ç°äº† "éç›®æ ‡" ä¸­å£°æ˜çš„å†…å®¹
```

#### Layer 3 - ä»£ç è´¨é‡æ£€æŸ¥

```
æ‰§è¡Œå‘½ä»¤å¹¶åˆ†æè¾“å‡º:

1. cargo check
   - è¿è¡Œ: cargo check --manifest-path core/Cargo.toml
   - è§£æç¼–è¯‘é”™è¯¯å’Œè­¦å‘Š

2. cargo clippy
   - è¿è¡Œ: cargo clippy --all-targets
   - æ”¶é›†æ‰€æœ‰ warnings

3. cargo fmt --check
   - è¿è¡Œ: cargo fmt --check
   - æ£€æµ‹æ ¼å¼ä¸ä¸€è‡´çš„æ–‡ä»¶

4. æ–‡æ¡£æ³¨é‡Šæ£€æŸ¥
   - æ‰«ææ‰€æœ‰ pub fn/struct/enum
   - éªŒè¯æ˜¯å¦æœ‰ /// æ³¨é‡Š

5. unsafe å—æ£€æŸ¥
   - æœç´¢æ‰€æœ‰ unsafe å…³é”®å­—
   - éªŒè¯æ˜¯å¦æœ‰è§£é‡Šæ³¨é‡Š
```

#### Layer 4 - æ·±åº¦æµ‹è¯•åˆ†æ

```
1. è¿è¡Œæµ‹è¯•å¥—ä»¶
   - è¿è¡Œ: cargo test --all-targets
   - æ”¶é›†å¤±è´¥çš„æµ‹è¯•ç”¨ä¾‹

2. åˆ†ææµ‹è¯•è¦†ç›–ç‡ï¼ˆéœ€è¦ tarpaulin æˆ–ç±»ä¼¼å·¥å…·ï¼‰
   - è¿è¡Œ: cargo tarpaulin --out Json
   - è§£æè¦†ç›–ç‡ç™¾åˆ†æ¯”
   - è¯†åˆ«è¦†ç›–ç‡ <80% çš„æ¨¡å—

3. è¯†åˆ«ç¼ºå¤±çš„æµ‹è¯•åœºæ™¯
   - æ‰«ææ‰€æœ‰ pub fn
   - æŸ¥æ‰¾æœªæµ‹è¯•çš„è¾¹ç•Œæ¡ä»¶:
     * ç©ºè¾“å…¥ / None å€¼
     * æœ€å¤§å€¼ / æœ€å°å€¼
     * Result::Err åˆ†æ”¯
     * Option::None åˆ†æ”¯

4. å¯†ç å­¦ä»£ç ç‰¹æ®Šæ£€æŸ¥
   - éªŒè¯æ˜¯å¦æœ‰ proptest å±æ€§æµ‹è¯•
   - éªŒè¯æ˜¯å¦æœ‰å·²çŸ¥çš„æµ‹è¯•å‘é‡
```

#### Layer 5 - å®‰å…¨æ€§ä¸ä¸å˜é‡æ£€æŸ¥

```
1. Zeroize å®ç°æ£€æŸ¥
   - æœç´¢æ‰€æœ‰æŒæ•æ„Ÿæ•°æ®çš„ç±»å‹
   - éªŒè¯å®ç°: Zeroize + ZeroizeOnDrop

2. INVARIANT_1 çºªå…ƒå•è°ƒæ€§
   - æœç´¢æ‰€æœ‰ epoch.version ä¿®æ”¹ç‚¹
   - éªŒè¯æ˜¯å¦å­˜åœ¨å•è°ƒé€’å¢æ£€æŸ¥

3. INVARIANT_2 Header å®Œå¤‡æ€§
   - éªŒè¯ DeviceHeader ä¸ epoch å…³è”æ­£ç¡®

4. INVARIANT_3 å› æœç†µéšœ
   - éªŒè¯ RECOVERY è§’è‰²æ— ç®¡ç†æƒé™

5. INVARIANT_4 å¦å†³æƒä¼˜å…ˆ
   - éªŒè¯ 48h å¦å†³æœºåˆ¶å®ç°

6. å¯†é’¥æ³„æ¼æ£€æŸ¥
   - æ£€æŸ¥ Debug impl æ˜¯å¦ä½¿ç”¨ Debug::fmt(|f| f.write_debug("[REDACTED]"))
   - æ£€æŸ¥ Clone impl æ˜¯å¦å­˜åœ¨ï¼ˆä¸åº”å…è®¸å¯†é’¥å…‹éš†ï¼‰

7. Kotlin æ˜æ–‡æ£€æŸ¥ï¼ˆå¦‚æœæœ‰ Android ä»£ç å˜æ›´ï¼‰
   - æ‰«æ kotlin æºç 
   - æ£€æŸ¥æ˜¯å¦æœ‰ ByteArray ç±»å‹çš„å¯†é’¥å˜é‡
```

### Step 4: ç”ŸæˆæŠ¥å‘Š

```
æ±‡æ€»æ‰€æœ‰å±‚çº§çš„é—®é¢˜:

1. æŒ‰ä¸¥é‡ç¨‹åº¦æ’åº: CRITICAL > ERROR > WARNING > INFO
2. å¯¹æ¯ä¸ªé—®é¢˜ç”Ÿæˆ:
   - é—®é¢˜æ ‡é¢˜
   - ä»£ç ä½ç½®ï¼ˆfile:lineï¼‰
   - é—®é¢˜æè¿°
   - å½“å‰ä»£ç ç‰‡æ®µ
   - ä¿®å¤å»ºè®®ï¼ˆå«ä»£ç ç¤ºä¾‹ï¼‰
   - ç›¸å…³æ–‡æ¡£é“¾æ¥

3. ç”Ÿæˆæ‘˜è¦ç»Ÿè®¡:
   - æ¯å±‚é€šè¿‡/å¤±è´¥/è­¦å‘Šè®¡æ•°
   - æ€»ä½“çŠ¶æ€åˆ¤æ–­

4. è¾“å‡ºåˆ°æ§åˆ¶å°ï¼ˆå¸¦æ ¼å¼åŒ–ï¼‰

5. å¯é€‰ä¿å­˜åˆ°æ–‡ä»¶
   - è·¯å¾„: reports/openspec-completion-<change-id>.md
```

---

## å¸¸è§é—®é¢˜ä¿®å¤æ¨¡æ¿

### é—®é¢˜ 1: çºªå…ƒå•è°ƒæ€§è¿å (L5-002)

**é”™è¯¯ä»£ç **:
```rust
pub fn next(&self) -> Self {
    Self {
        version: self.version + 1,  // å¯èƒ½æº¢å‡º
        timestamp: SystemTime::now(),
        algorithm: self.algorithm.clone(),
    }
}
```

**ä¿®å¤å»ºè®®**:
```rust
pub fn next(&self) -> Result<Self, CryptoError> {
    let new_version = self.version.checked_add(1)
        .ok_or_else(|| CryptoError::InvariantViolation(
            "Epoch version overflow".into()
        ))?;

    // éªŒè¯çºªå…ƒå•è°ƒæ€§ï¼ˆINVARIANT_1ï¼‰
    if new_version <= self.version {
        return Err(CryptoError::InvariantViolation(
            "Epoch must be monotonically increasing".into()
        ));
    }

    Ok(Self {
        version: new_version,
        timestamp: SystemTime::now(),
        algorithm: self.algorithm.clone(),
    })
}
```

### é—®é¢˜ 2: ç¼ºå°‘ Zeroize å®ç° (L5-001)

**é”™è¯¯ä»£ç **:
```rust
pub struct VaultKey {
    key: [u8; 32],
}
```

**ä¿®å¤å»ºè®®**:
```rust
use zeroize::{Zeroize, ZeroizeOnDrop};

#[derive(Zeroize, ZeroizeOnDrop)]
pub struct VaultKey {
    key: [u8; 32],
}

impl VaultKey {
    pub fn new(bytes: [u8; 32]) -> Self {
        Self { key: bytes }
    }
}

// ç¡®ä¿ä¸æš´éœ²å¯†é’¥ææ–™
impl fmt::Debug for VaultKey {
    fn fmt(&self, f: &mut fmt::Formatter<'_>) -> fmt::Result {
        f.write_str("VaultKey([REDACTED])")
    }
}
```

### é—®é¢˜ 3: æµ‹è¯•è¦†ç›–ç‡ä¸è¶³ (L4-003)

**å½“å‰çŠ¶æ€**:
- device.rs æµ‹è¯•è¦†ç›–ç‡: 42.3%
- ç¼ºå¤±: DeviceId::generate() å”¯ä¸€æ€§æµ‹è¯•ã€DeviceHeader::revoke() çŠ¶æ€è½¬æ¢

**ä¿®å¤å»ºè®®**:
```rust
#[cfg(test)]
mod tests {
    use super::*;

    #[test]
    fn test_device_id_uniqueness() {
        let ids: Vec<_> = (0..1000)
            .map(|_| DeviceId::generate())
            .collect();
        let unique: HashSet<_> = ids.iter().collect();
        assert_eq!(unique.len(), 1000); // å…¨éƒ¨å”¯ä¸€
    }

    #[test]
    fn test_device_header_revocation() {
        let mut header = DeviceHeader::new(/* ... */);
        assert_eq!(header.status(), DeviceStatus::Active);

        header.revoke();
        assert_eq!(header.status(), DeviceStatus::Revoked);

        // è¢«æ’¤é”€çš„è®¾å¤‡æ— æ³•è§£å¯†æ–°çºªå…ƒæ•°æ®
        assert!(!header.can_decrypt_epoch(&Epoch::new(1)));
    }
}
```

---

## é›†æˆåˆ°å¼€å‘æµç¨‹

### Git Hook é›†æˆï¼ˆæ¨èï¼‰

åœ¨ `.git/hooks/pre-push` æ·»åŠ ï¼š

```bash
#!/bin/bash
# æ¨é€å‰è‡ªåŠ¨è¿è¡Œå®Œæˆæƒ…å†µå®¡æŸ¥

echo "ğŸ” è¿è¡Œ OpenSpec å®Œæˆæƒ…å†µå®¡æŸ¥..."

# æ£€æŸ¥æ˜¯å¦æœ‰ OpenSpec å˜æ›´
CHANGES=$(git diff --name-only HEAD~1 | grep "openspec/changes/")
if [ -n "$CHANGES" ]; then
    # æå–å˜æ›´ ID
    CHANGE_ID=$(echo "$CHANGES" | head -1 | cut -d'/' -f3)

    # è°ƒç”¨ openspec-completion skill
    echo "å®¡æŸ¥ææ¡ˆ: $CHANGE_ID"
    # è¿™é‡Œéœ€è¦é…ç½® AI assistant çš„æŠ€èƒ½è°ƒç”¨
fi
```

### CI/CD é›†æˆ

åœ¨ CI pipeline ä¸­æ·»åŠ ï¼š

```yaml
- name: Review OpenSpec Completion
  run: |
    # æ£€æµ‹æ´»è·ƒææ¡ˆ
    PROPOSALS=$(find openspec/changes -maxdepth 1 -type d ! -path "openspec/changes")

    for proposal in $PROPOSALS; do
      CHANGE_ID=$(basename "$proposal")
      echo "å®¡æŸ¥ææ¡ˆ: $CHANGE_ID"

      # è°ƒç”¨ AI assistant æˆ–è¿è¡Œå®¡æŸ¥è„šæœ¬
      npm run openspec:completion -- "$CHANGE_ID"
    done
```

---

## ç›¸å…³æŠ€èƒ½

- `openspec-review` - ææ¡ˆåˆ›å»ºæ—¶çš„æ–‡æ¡£å®¡æŸ¥
- `aeternum-checkpoint` - å¼€å‘å‰çš„æ–‡æ¡£ä¸çº¦æŸæ£€æŸ¥
- `aeternum-crypto` - å¯†ç å­¦åŸè¯­å¼€å‘
- `aeternum-protocol` - åè®®ä¸çŠ¶æ€æœºå¼€å‘
- `aeternum-invariant` - ä¸å˜é‡éªŒè¯

---

## æ›´æ–°æ—¥å¿—

- **v1.0.0** (2026-02-13): åˆå§‹ç‰ˆæœ¬
  - å®ç° 5 å±‚å®¡æŸ¥æ¡†æ¶
  - æ”¯æŒ Checkpoint åˆè§„æ€§éªŒè¯
  - æ·±åº¦æµ‹è¯•åˆ†æ
  - å®‰å…¨æ€§ä¸ä¸å˜é‡å®¡æŸ¥
  - è¯¦ç»†ä¿®å¤å»ºè®®
